<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.record.travel.dao.BoardMapper">
	<resultMap id="BoardResultMap" type="BoardDto">
		<id property="num" column="num" />
		<result property="title" column="title" />
		<result property="content" column="content" />
		<result property="writer" column="writer" />
		<result property="travelDate" column="travelDate" />
		<result property="writeDate" column="writeDate" />
		<result property="viewCnt" column="viewCnt" />
		<result property="replyCnt" column="replyCnt" />
		<result property="fileCnt" column="fileCnt" />
		<result property="tags" column="tags" />
		
	</resultMap>

	<insert id="insertBoard">
		INSERT INTO board(num, title, content, writer, travelDate, fileCnt, tags) 
		VALUES
		(#{num}, #{title}, #{content}, #{writer}, #{travelDate}, #{fileCnt}, #{tags})
	</insert>
	
	<update id="updateBoard">
		UPDATE board SET
		title = #{title}, content = #{content},
		travelDate = #{travelDate} , fileCnt = #{fileCnt}, tags= #{tags}
		WHERE num = #{num}
	</update>

	<delete id="deleteBoard">
		DELETE FROM board WHERE num = #{num}
	</delete>

	<select id="selectOneBoard" resultMap="BoardResultMap">
		SELECT * FROM board WHERE num = #{num}
	</select>

	<select id="selectAllBoard" resultType="boardDto">
		SELECT * FROM board
	</select>

	<!-- 검색 -->
	<select id="selectSearchBoard" parameterType="java.util.HashMap"
		resultType="boardDto">
		SELECT * FROM board
	</select>

	<!-- 페이징 -->
	<!-- <select id="listPaging" resultMap="BoardResultMap"> <![CDATA[ select 
		* from board where num > 0 order by num DESC, writeDate desc LIMIT #{page}, 
		8 ]]> </select> -->

	<select id="listCriteria" resultMap="BoardResultMap">
    	<![CDATA[
			select * 
			  from board
			  where num > 0
			  order by num DESC, writeDate desc
			  LIMIT	#{pageStart}, #{perPageNum}
		]]>
	</select>

	<!-- 게시글 개수 구하기 -->
	<select id="countBoards" resultType="int">
		<![CDATA[
			select count(num)
				from board
			where num>0
		]]>
	</select>
	
	<!-- 댓글 수 업데이트 -->
	<update id="updateReplyCnt">
		update board set replyCnt = replyCnt + #{amount} 
		where num = #{num}
	</update>
	
	<!-- 조회 수 업데이트 -->
	<update id="updateViewCnt">
		update board set viewCnt = viewCnt + 1
		where num = #{num}
	</update>
	
	<update id="updateFileCnt">
		update board set fileCnt = (
			select count(num) 
			from file 
			where num = #{num}
		)
		where num = #{num}
	</update>
</mapper>